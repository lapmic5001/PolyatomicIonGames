<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Ion Weaponsmith - Polyatomic Mastery</title>
        <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
        <style>
            body {
                font-family: "Press Start 2P", cursive;
                background: #000;
                color: #fff;
                text-align: center;
                padding: 20px;
            }
            h1 {
                margin-bottom: 10px;
            }
            #moneyCounter,
            #ordersPanel {
                font-size: 1.5em;
                margin-bottom: 20px;
            }
            #moneyCounter img {
                vertical-align: middle;
                width: 16px;
                height: 16px;
                margin-left: 5px;
            }
            select,
            button,
            input {
                font-family: "Press Start 2P", cursive;
                font-size: 1em;
                padding: 10px;
                margin: 10px;
                background: #222;
                color: #fff;
                border: 2px solid #fff;
                cursor: pointer;
            }
            input {
                width: 200px;
                text-align: center;
            }
            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            #progressBar,
            #orderProgress {
                width: 300px;
                height: 20px;
                border: 2px solid #fff;
                margin: 10px auto;
                background: #222;
                position: relative;
            }
            #progressFill,
            #orderFill {
                height: 100%;
                background: #0f0;
                width: 0%;
            }
            #message,
            #ordersList {
                font-size: 1em;
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <h1>Ion Weaponsmith</h1>
        <div id="moneyCounter">
            Ionites: <span id="ionites">100</span>
            <img src="ionite_icon.png" alt="Ionite Icon" />
        </div>

        <div>
            <label for="ionSelect">Bullet Type (Ion):</label>
            <select id="ionSelect"></select>
        </div>

        <div>
            <input type="text" id="formulaInput" placeholder="Enter Formula (e.g. NH4+1)" />
            <button id="synthesizeButton">Synthesize</button>
            <button id="revealButton">Reveal Recipe (-5 Ionites)</button>
        </div>

        <div id="progressBar">
            <div id="progressFill"></div>
        </div>

        <div id="ordersPanel">
            <h2>Orders</h2>
            <div id="ordersList"></div>
        </div>

        <div id="message"></div>

        <script>
            const ions = [
                { name: "Ammonium", formula: "NH4+1", charge: 1, synthesisTime: 1500, sellPrice: 12 },
                { name: "Acetate", formula: "C2H3O2-1", charge: -1, synthesisTime: 1800, sellPrice: 15 },
                { name: "Bicarbonate", formula: "HCO3-1", charge: -1, synthesisTime: 1700, sellPrice: 14 },
                { name: "Bromate", formula: "BrO3-1", charge: -1, synthesisTime: 1900, sellPrice: 16 },
                { name: "Cyanide", formula: "CN-1", charge: -1, synthesisTime: 1400, sellPrice: 13 },
                { name: "Hydroxide", formula: "OH-1", charge: -1, synthesisTime: 1300, sellPrice: 11 },
                { name: "Nitrate", formula: "NO3-1", charge: -1, synthesisTime: 2000, sellPrice: 18 },
                { name: "Nitrite", formula: "NO2-1", charge: -1, synthesisTime: 1800, sellPrice: 15 },
                { name: "Thiocyanate", formula: "SCN-1", charge: -1, synthesisTime: 1600, sellPrice: 14 },
                { name: "Carbonate", formula: "CO3-2", charge: -2, synthesisTime: 2500, sellPrice: 25 },
                { name: "Chromate", formula: "CrO4-2", charge: -2, synthesisTime: 2700, sellPrice: 28 },
                { name: "Peroxide", formula: "O2-2", charge: -2, synthesisTime: 2200, sellPrice: 22 },
                { name: "Sulfate", formula: "SO3-2", charge: -2, synthesisTime: 2600, sellPrice: 26 },
                { name: "Sulfite", formula: "SO2-2", charge: -2, synthesisTime: 2400, sellPrice: 24 },
                { name: "Tartrate", formula: "C4H4O6-2", charge: -2, synthesisTime: 2800, sellPrice: 30 },
                { name: "Borate", formula: "BO3-3", charge: -3, synthesisTime: 3200, sellPrice: 35 },
                { name: "Citrate", formula: "C6H5O7-3", charge: -3, synthesisTime: 3500, sellPrice: 38 },
                { name: "Phosphate", formula: "PO4-3", charge: -3, synthesisTime: 3300, sellPrice: 36 },
                { name: "Phosphite", formula: "PO3-3", charge: -3, synthesisTime: 3100, sellPrice: 34 },
                { name: "Silicate", formula: "SiO4-4", charge: -4, synthesisTime: 4000, sellPrice: 45 }
            ];

            let ionites = 100;
            let orders = [];
            let maxOrders = 5;
            let orderInterval = 15000;

            const ionSelect = document.getElementById("ionSelect");
            const synthesizeButton = document.getElementById("synthesizeButton");
            const revealButton = document.getElementById("revealButton");
            const formulaInput = document.getElementById("formulaInput");
            const ionitesDisplay = document.getElementById("ionites");
            const progressFill = document.getElementById("progressFill");
            const messageDiv = document.getElementById("message");
            const ordersList = document.getElementById("ordersList");

            function updateIonitesDisplay() {
                ionitesDisplay.textContent = ionites;
            }

            function addOrder() {
                if (orders.length >= maxOrders) {
                    alert("Too many unfulfilled orders! Game Over.");
                    location.reload();
                }
                const ion = ions[Math.floor(Math.random() * ions.length)];
                const quantity = Math.floor(Math.random() * 3) + 1;
                const tip = Math.floor(Math.random() * 10);
                const reward = ion.sellPrice * quantity + tip;
                orders.push({ ion, quantity, remaining: quantity, reward });
                renderOrders();
            }

            function renderOrders() {
                ordersList.innerHTML = "";
                orders.forEach((order, index) => {
                    const orderElement = document.createElement("div");
                    orderElement.textContent = `${order.quantity - order.remaining}/${order.quantity} ${order.ion.name} Bullets - Reward: ${order.reward} Ionites`;
                    ordersList.appendChild(orderElement);
                });
            }

            function synthesizeBullet() {
                const selectedIon = ions[ionSelect.value];
                const userInput = formulaInput.value.trim();

                if (userInput !== selectedIon.formula) {
                    messageDiv.textContent = "Incorrect formula! Try again.";
                    return;
                }

                synthesizeButton.disabled = true;
                messageDiv.textContent = `Synthesizing ${selectedIon.name} bullet...`;
                formulaInput.value = "";

                let progress = 0;
                progressFill.style.width = "0%";
                const synthesisTime = selectedIon.synthesisTime;
                const interval = 50;

                const timer = setInterval(() => {
                    progress += interval;
                    progressFill.style.width = Math.min((progress / synthesisTime) * 100, 100) + "%";
                    if (progress >= synthesisTime) {
                        clearInterval(timer);
                        orders.forEach((order) => {
                            if (order.ion.name === selectedIon.name && order.remaining > 0) {
                                order.remaining--;
                            }
                        });
                        orders = orders.filter((order) => order.remaining > 0);
                        messageDiv.textContent = `${selectedIon.name} bullet synthesized!`;
                        updateIonitesDisplay();
                        renderOrders();
                        synthesizeButton.disabled = false;
                    }
                }, interval);
            }

            setTimeout(addOrder, 5000);
            setInterval(addOrder, orderInterval);
            updateIonitesDisplay();
        </script>
    </body>
</html>
